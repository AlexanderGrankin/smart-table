(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function e(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerPolicy&&(s.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?s.credentials="include":t.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(t){if(t.ep)return;t.ep=!0;const s=e(t);fetch(t.href,s)}})();function v(n){const a="https://webinars.webdev.education-services.ru/sp7-api";let e,o,t,s;const r=i=>i.map(c=>({id:c.receipt_id,date:c.date,seller:e[c.seller_id],customer:o[c.customer_id],total:c.total_amount}));return{getIndexes:async()=>((!e||!o)&&([e,o]=await Promise.all([fetch(`${a}/sellers`).then(i=>i.json()),fetch(`${a}/customers`).then(i=>i.json())])),{sellers:e,customers:o}),getRecords:async(i,c=!1)=>{const p=new URLSearchParams(i).toString();if(s===p&&!c)return t;const m=await(await fetch(`${a}/records?${p}`)).json();return s=p,t={total:m.total,items:r(m.items)},t}}}function g(n){const e=document.getElementById(n).content.firstElementChild.cloneNode(!0),o=Array.from(e.querySelectorAll("[data-name]")).reduce((t,s)=>(t[s.dataset.name]=s,t),{});return{container:e,elements:o}}function w(n){return Array.from(n.entries()).reduce((a,[e,o])=>(a[e]=o,a),{})}function E(n,a,e){n=Math.max(1,Math.min(a,n)),e=Math.min(a,e);let o=Math.max(1,n-Math.floor(e/2)),t=o+e-1;t>a&&(t=a,o=Math.max(1,t-e+1));const s=[];for(let r=o;r<=t;r++)s.push(r);return s}function P(n,a){const{tableTemplate:e,rowTemplate:o,before:t,after:s}=n,r=g(e);return t.forEach(d=>{r[d]=g(d),r.container.prepend(r[d].container)}),s.forEach(d=>{r[d]=g(d),r.container.append(r[d].container)}),r.container.addEventListener("change",()=>{a()}),r.container.addEventListener("reset",()=>{setTimeout(a)}),r.container.addEventListener("submit",d=>{d.preventDefault(),a(d.submitter)}),{...r,render:d=>{const i=d.map(c=>{const u=g(o);return Object.keys(c).forEach(p=>{p in u.elements&&(u.elements[p].textContent=c[p])}),u.container});r.elements.rows.replaceChildren(...i)}}}const x=({pages:n,fromRow:a,toRow:e,totalRows:o},t)=>{const s=n.firstElementChild.cloneNode(!0);n.firstElementChild.remove();let r;return{updatePagination:(i,{page:c,limit:u})=>{r=Math.ceil(i/u);const p=E(c,r,5);n.replaceChildren(...p.map(f=>{const m=s.cloneNode(!0);return t(m,f,f===c)})),a.textContent=(c-1)*u+1,e.textContent=Math.min(c*u,i),o.textContent=i},applyPagination:(i,c,u)=>{const p=c.rowsPerPage;let f=c.page;if(u)switch(u.name){case"prev":f=Math.max(1,f-1);break;case"next":f=Math.min(r,f+1);break;case"first":f=1;break;case"last":f=r;break}return Object.assign({},i,{limit:p,page:f})}}},S={none:"up",up:"down",down:"none"};function O(n){return(a,e)=>{let o=null,t=null;e&&e.name==="sort"?(e.dataset.value=S[e.dataset.value],o=e.dataset.field,t=e.dataset.value,n.forEach(r=>{r.dataset.field!==e.dataset.field&&(r.dataset.value="none")})):n.forEach(r=>{r.dataset.value!=="none"&&(o=r.dataset.field,t=r.dataset.value)});const s=o&&t!=="none"?`${o}:${t}`:null;return s?Object.assign({},a,{sort:s}):a}}function C(n){return{updateIndexes:(o,t)=>{Object.keys(t).forEach(s=>{o[s].append(...Object.values(t[s]).map(r=>{const l=document.createElement("option");return l.textContent=r,l.value=r,l}))})},applyFiltering:(o,t,s)=>{if(s&&s.name==="clear"){const l=s.dataset.field,i=s.parentElement.querySelector("input");i&&(i.value=""),i&&(i.value=""),l&&l in t&&(t[l]="")}const r={};return Object.keys(n).forEach(l=>{n[l]&&["INPUT","SELECT"].includes(n[l].tagName)&&n[l].value&&(r[`filter[${n[l].name}]`]=n[l].value)}),Object.keys(r).length?Object.assign({},o,r):o}}}function j(n){return(a,e)=>e[n]?Object.assign({},a,{search:e[n]}):a}const y=v();function M(){const n=w(new FormData(h.container)),a=parseInt(n.rowsPerPage),e=parseInt(n.page??1);return{...n,rowsPerPage:a,page:e}}async function b(n){let a=M(),e={};e=T(e,a,n),e=$(e,a,n),e=R(e,a,n),e=L(e,a,n);const{total:o,items:t}=await y.getRecords(e);I(o,e),h.render(t)}const h=P({tableTemplate:"table",rowTemplate:"row",before:["header","filter","search"],after:["pagination"]},b),{applyPagination:T,updatePagination:I}=x(h.pagination.elements,(n,a,e)=>{const o=n.querySelector("input"),t=n.querySelector("span");return o.value=a,o.checked=e,t.textContent=a,n}),L=O([h.header.elements.sortByDate,h.header.elements.sortByTotal]),R=j("search"),{applyFiltering:$,updateIndexes:q}=C(h.filter.elements),D=document.querySelector("#app");D.appendChild(h.container);async function F(){const n=await y.getIndexes();q(h.filter.elements,{searchBySeller:n.sellers})}F().then(b);
